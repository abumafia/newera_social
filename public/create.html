<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NewEra - Yangi Post Yaratish</title>
    <meta property="og:title" content="NewEra - Yangi Post Yaratish">
    <meta property="og:description" content="Yangi post yarating!">
    <meta property="og:image" content="./uploads/icon.png">
    <meta property="og:url" content="https://newera.com/create.html">
    <meta property="og:site_name" content="NewEra">
    <meta property="og:type" content="website">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dark: {
                            100: '#1a1a1a',
                            200: '#141414',
                            300: '#0f0f0f',
                            400: '#0a0a0a',
                            500: '#050505',
                        },
                        glass: {
                            light: 'rgba(255, 255, 255, 0.1)',
                            dark: 'rgba(0, 0, 0, 0.4)',
                            border: 'rgba(255, 255, 255, 0.2)'
                        }
                    },
                    backdropBlur: {
                        xs: '2px',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 50%, #0a0a0a 100%);
            color: #f1f1f1;
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(15, 15, 15, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        }
        
        .glass-nav {
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .glass-input {
            background: rgba(30, 30, 30, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: white;
        }
        
        .glass-input:focus {
            background: rgba(40, 40, 40, 0.7);
            border-color: rgba(29, 161, 242, 0.6);
            box-shadow: 0 0 0 2px rgba(29, 161, 242, 0.2);
        }
        
        .twitter-blue {
            background-color: #1DA1F2;
        }
        
        .twitter-blue:hover {
            background-color: #1a91da;
        }

        /* Stiker grid */
        .sticker-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 0.5rem;
            max-height: 200px;
            overflow-y: auto;
            padding: 1rem;
            background: rgba(20, 20, 20, 0.8);
            border-radius: 0.5rem;
        }

        .sticker-item {
            width: 40px;
            height: 40px;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: transform 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
        }

        .sticker-item:hover {
            transform: scale(1.1);
        }

        .premium-sticker {
            border: 2px solid #ffd700;
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #000;
            animation: sparkle 2s infinite;
        }

        @keyframes sparkle {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Animated stickers in posts */
        .animated-sticker {
            max-height: 1.5em;
            max-width: 1.5em;
            vertical-align: middle;
            display: inline-block;
        }

        /* Media preview */
        .media-preview {
            position: relative;
            max-width: 100%;
            max-height: 300px;
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .remove-media {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            z-index: 10;
        }

        /* Quill custom styles */
        .ql-editor {
            min-height: 200px;
            font-size: 1rem;
        }

        .ql-editor img.animated-sticker {
            max-height: 1.5em;
            max-width: 1.5em;
            vertical-align: middle;
        }

        .ql-toolbar {
            background: rgba(30, 30, 30, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 0.5rem 0.5rem 0 0;
        }

        /* Template modal */
        .template-item {
            padding: 1rem;
            background: rgba(40, 40, 40, 0.5);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .template-item:hover {
            background: rgba(50, 50, 50, 0.7);
        }

        /* Mobile optimizations */
        @media (max-width: 640px) {
            .sticker-grid {
                grid-template-columns: repeat(auto-fill, minmax(30px, 1fr));
            }

            .sticker-item {
                width: 30px;
                height: 30px;
                font-size: 1.4rem;
            }

            /* Bottom navbar styles */
            .bottom-nav {
                background: rgba(10, 10, 10, 0.95);
                backdrop-filter: blur(10px);
                border-top: 1px solid rgba(255, 255, 255, 0.1);
            }

            .bottom-nav-item {
                flex: 1;
                padding: 0.5rem;
                text-align: center;
                color: #a0a0a0;
                transition: color 0.2s ease;
            }

            .bottom-nav-item.active {
                color: #1DA1F2;
            }

            .bottom-nav-item:hover {
                color: #1DA1F2;
            }
        }
    </style>
</head>
<body class="font-sans">
    <!-- Navbar -->
    <nav class="glass-nav fixed w-full top-0 z-40 px-4">
        <div class="flex justify-between items-center py-3">
            <a href="/" class="text-xl font-bold flex items-center">
                <img src="./uploads/icon.png" alt="NewEra Logo" class="h-8 mr-2 filter brightness-125">
                <span class="hidden sm:inline">NewEra</span>
            </a>
            <button id="backBtn" class="text-gray-400 hover:text-white text-2xl bg-transparent rounded-full p-1">&larr;</button>
        </div>
    </nav>

    <!-- Asosiy kontent -->
    <div class="max-w-2xl mx-auto px-4 pt-20 pb-20">
        <div class="glass-card p-6 rounded-2xl">
            <h2 class="text-xl font-semibold mb-4">Yangi post yaratish</h2>
            <form id="createPostForm">
                <!-- Editor -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-300 mb-2">Post mazmuni</label>
                    <div id="editor"></div>
                </div>
                <div class="mb-3 text-sm text-gray-400">
                    Havolalarni olish uchun bu kanaldan foydalaning: 
                    <a href="https://t.me/hallaym" class="text-blue-400 hover:text-blue-300 transition-colors">Telegram</a>
                </div>
                
                <!-- Templates button (premium) -->
                <div id="templatesSection" class="mb-4 hidden">
                    <button type="button" id="templatesBtn" class="glass-button w-full p-3 rounded-xl text-sm hover:bg-gray-700">
                        üìù Shablonlar
                    </button>
                </div>

                <!-- Readability button (premium) -->
                <div id="readabilitySection" class="mb-4 hidden">
                    <button type="button" id="readabilityBtn" class="glass-button w-full p-3 rounded-xl text-sm hover:bg-gray-700">
                        üìä O'qilish darajasini tekshirish
                    </button>
                </div>
                
                <!-- Media yuklash bo'limi -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-300 mb-2">Rasm/Video qo'shish</label>
                    <div class="flex flex-col gap-2">
                        <input type="file" id="postFile" accept="image/*,video/*" class="glass-input p-3 rounded-xl hidden">
                        <label for="postFile" class="glass-button text-center p-3 rounded-xl cursor-pointer hover:bg-gray-700">
                            üì± Qurilmadan tanlash
                        </label>
                        <input type="text" id="postMedia" placeholder="üîó Havola orqali (ixtiyoriy)" 
                            class="glass-input p-3 rounded-xl">
                    </div>
                    <div id="mediaPreview" class="mt-2"></div>
                </div>

                <!-- Stikerlar bo'limi -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-300 mb-2">Stikerlar</label>
                    <div id="stickerSection" class="sticker-grid hidden">
                        <!-- Stikerlar JS orqali yuklanadi -->
                    </div>
                    <button type="button" id="toggleStickers" class="glass-button w-full mt-2 p-2 rounded-xl text-sm">
                        Stikerlarni ko'rsatish/yashirish
                    </button>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-300 mb-2">Boost darajasi (har daraja 10 coin)</label>
                    <input type="number" id="boostLevel" min="0" max="5" value="0" class="glass-input w-full p-3 rounded-xl">
                </div>
                <button type="submit" 
                    class="twitter-blue text-white px-4 py-3 rounded-full hover:bg-blue-600 w-full transition-colors font-medium">
                    Post qilish
                </button>
            </form>
        </div>
    </div>

    <!-- Template Modal -->
    <div id="templateModal" class="fixed inset-0 bg-black bg-opacity-70 hidden flex items-center justify-center z-50">
        <div class="glass-card p-6 rounded-2xl w-full max-w-md mx-4 max-h-96 overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">Shablonlar</h3>
                <button id="closeTemplateModal" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>
            <div id="templateList" class="space-y-2"></div>
        </div>
    </div>

    <!-- Mobile Bottom Navbar -->
    <nav class="fixed bottom-0 left-0 right-0 bg-gray-900 border-t border-gray-700 hidden md:hidden z-40 bottom-nav">
        <div class="flex justify-around items-center py-2">
            <a href="/" class="bottom-nav-item">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                </svg>
                <span class="text-xs mt-1">Asosiy</span>
            </a>
            <a href="/create.html" class="bottom-nav-item active relative">
                <div class="absolute -top-2 -right-2 bg-blue-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs">+</div>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
                <span class="text-xs mt-1">Yaratish</span>
            </a>
            <a href="/profile" class="bottom-nav-item">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
                <span class="text-xs mt-1">Profil</span>
            </a>
        </div>
    </nav>

    <script>
        let sessionUserId = null;
        let currentUser = null;
        let selectedFile = null;
        let selectedMediaUrl = '';
        let stickersVisible = false;
        let quill = null;

        // Oddiy stikerlar (emoji)
        const basicStickers = ['üòÄ', 'üòÇ', '‚ù§Ô∏è', 'üëç', 'üî•', 'üéâ', 'üòé', 'üëè', 'üåü', 'üöÄ'];

        // Premium animatsiyali stikerlar (GIF URLs)
        const premiumAnimatedStickers = [
            { name: 'Crown Sparkle', url: 'https://media.tenor.com/V9vZf9w7w5YAAAAC/crown-royalty.gif' },
            { name: 'Diamond Shine', url: 'https://media.giphy.com/media/3o7aDgfccATWjWmr7O/giphy.gif' },
            { name: 'Sparkle Star', url: 'https://media.giphy.com/media/l41lX9g6Bz7I0o6nC/giphy.gif' },
            { name: 'Twinkling Star', url: 'https://media.giphy.com/media/26ufnwz3wDUk2i1oo/giphy.gif' },
            { name: 'Golden Crown', url: 'https://media.giphy.com/media/3o7btPCcdN1z6Mh9Du/giphy.gif' },
            { name: 'Magic Spark', url: 'https://media.giphy.com/media/3o7TKsQ8J1p7qYxKxS/giphy.gif' }
        ];

        // Shablonlar
        const basicTemplates = [
            {name: 'Sarlavha va matn', html: '<h2 class="ql-header-2">Sarlavha</h2><p>Mazmun bu yerda...</p>'},
            {name: 'Ruyxat', html: '<ul class="ql-list"><li>Element 1</li><li>Element 2</li><li>Element 3</li></ul>'},
            {name: 'Iqtibos', html: '<blockquote class="ql-blockquote">Sizning iqtibosingiz bu yerda...</blockquote>'}
        ];

        const premiumTemplates = [
            ...basicTemplates,
            {name: 'E\'lon', html: '<h1 class="ql-header-1">E\'lon!</h1><p>Tafsilotlar...</p>'},
            {name: 'Qanday qilish', html: '<h2>Qanday qilish</h2><ol class="ql-list"><li>1-qadam</li><li>2-qadam</li><li>3-qadam</li></ol>'},
            {name: 'Maslahat', html: '<div style="background: #f0f0f0; padding: 1rem; border-left: 4px solid #1DA1F2; border-radius: 0.5rem;"><h3>Maslahat:</h3><p>Tez maslahat bu yerda.</p></div>'},
            {name: 'Savol', html: '<h3 class="ql-header-3">Savol:</h3><p>Sizning savolingiz...</p>'},
            {name: 'Natija', html: '<p><strong>Natija:</strong> Bu yerda natijangizni yozing.</p>'}
        ];

        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        // Readability functions (Flesch Reading Ease)
        function getSyllables(word) {
            word = word.toLowerCase();
            if (word.length <= 3) { return 1; }
            word = word.replace(/(?:[^laeiouy]es|ed|[^laeiouy]e)$/, '');
            word = word.replace(/^y/, '');
            var syl = word.match(/[aeiouy]{1,2}/g);
            return (syl && syl.length) || 0;
        }

        function calculateFlesch(totalSentences, totalWords, totalSyllables) {
            return 206.835 - (1.015 * (totalWords / totalSentences)) - (84.6 * (totalSyllables / totalWords));
        }

        function calculateReadability(text) {
            var totalSentences = 0, totalWords = 0, totalSyllables = 0;
            
            var sentences = text.split(/[.!?]/);
            totalSentences = sentences.length;
            sentences.forEach(function (sentence) {
                var word = "";
                for (var i = 0; i < sentence.length; i++) {
                    word += sentence[i];
                    if (sentence[i] == " ") {
                        if (word.trim()) {
                            totalWords++;
                            totalSyllables += getSyllables(word.trim());
                        }
                        word = "";
                    }
                }
                if (word.trim()) {
                    totalWords++;
                    totalSyllables += getSyllables(word.trim());
                }
            });
            
            if (totalSentences === 0 || totalWords === 0) return 0;
            return calculateFlesch(totalSentences, totalWords, totalSyllables);
        }

        document.addEventListener('DOMContentLoaded', function() {
            initializeSession();
            setupCreateForm();

            document.getElementById('backBtn').addEventListener('click', () => {
                window.history.back();
            });
        });

        async function initializeSession() {
            try {
                const response = await fetch('/user/me');
                if (response.status === 401) {
                    window.location.href = '/register-login.html';
                    return;
                }
                
                const data = await response.json();
                if (data.success) {
                    currentUser = data.user;
                    sessionUserId = data.user._id;
                    initQuill();
                    loadStickers();
                    setupPremiumFeatures();
                }
            } catch (error) {
                console.error('Session ma\'lumotlarini olishda xatolik:', error);
            }
        }

        function initQuill() {
            const toolbarConfig = currentUser.isPremium && (!currentUser.premiumExpiresAt || new Date(currentUser.premiumExpiresAt) > new Date()) 
                ? [
                    [{ 'header': [1, 2, 3, false] }],
                    ['bold', 'italic', 'underline', 'strike'],
                    [{ 'color': [] }, { 'background': [] }],
                    [{ 'align': [] }],
                    [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                    ['blockquote', 'code-block'],
                    [{ 'indent': '-1'}, { 'indent': '+1' }],
                    ['link'],
                    [{ 'size': ['small', false, 'large', 'huge'] }],
                    ['clean']
                  ]
                : [
                    ['bold', 'italic'],
                    [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                    ['clean']
                  ];

            quill = new Quill('#editor', {
                theme: 'snow',
                modules: {
                    toolbar: toolbarConfig
                },
                placeholder: 'Nima yangilik? Stikerlar qo\'shing! üòä'
            });
        }

        function setupPremiumFeatures() {
            const isPremiumActive = currentUser.isPremium && (!currentUser.premiumExpiresAt || new Date(currentUser.premiumExpiresAt) > new Date());
            if (isPremiumActive) {
                document.getElementById('templatesSection').classList.remove('hidden');
                document.getElementById('readabilitySection').classList.remove('hidden');
            }
        }

        function setupCreateForm() {
            // File input
            document.getElementById('postFile').addEventListener('change', handleFileSelect);

            // Media URL input
            document.getElementById('postMedia').addEventListener('input', handleMediaUrlChange);

            // Stiker toggle
            document.getElementById('toggleStickers').addEventListener('click', () => {
                stickersVisible = !stickersVisible;
                const section = document.getElementById('stickerSection');
                section.classList.toggle('hidden', !stickersVisible);
            });

            // Templates
            document.getElementById('templatesBtn').addEventListener('click', () => {
                const modal = document.getElementById('templateModal');
                const list = document.getElementById('templateList');
                const templates = currentUser.isPremium && (!currentUser.premiumExpiresAt || new Date(currentUser.premiumExpiresAt) > new Date()) ? premiumTemplates : basicTemplates;
                
                list.innerHTML = templates.map(t => `<div class="template-item" data-html="${t.html}">${t.name}</div>`).join('');
                
                list.querySelectorAll('.template-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const html = item.dataset.html;
                        quill.clipboard.dangerouslyPasteHTML(0, html);
                        modal.classList.add('hidden');
                    });
                });
                
                modal.classList.remove('hidden');
            });

            document.getElementById('closeTemplateModal').addEventListener('click', () => {
                document.getElementById('templateModal').classList.add('hidden');
            });

            // Readability
            document.getElementById('readabilityBtn').addEventListener('click', () => {
                const text = quill.getText().trim();
                if (!text) return showMessage('Matn kiriting', 'error');
                const score = calculateReadability(text);
                let level = '';
                if (score > 80) level = 'Juda oson';
                else if (score > 60) level = 'Oson';
                else if (score > 40) level = 'O\'rta';
                else if (score > 20) level = 'Qiyin';
                else level = 'Juda qiyin';
                showMessage(`O\'qilish darajasi: ${score.toFixed(2)} (${level})`, 'success');
            });

            const createPostForm = document.getElementById("createPostForm");
            createPostForm.addEventListener("submit", async (e) => {
                e.preventDefault();
                
                const content = quill.root.innerHTML;
                const boostLevel = parseInt(document.getElementById('boostLevel').value) || 0;
                
                if (!content.trim()) return showMessage('Post matni bo\'sh bo\'lmasligi kerak', 'error');
                
                try {
                    if (selectedFile) {
                        // File upload
                        const formData = new FormData();
                        formData.append('content', content);
                        formData.append('mediaFile', selectedFile);
                        formData.append('boostLevel', boostLevel);

                        const response = await fetch('/posts', {
                            method: 'POST',
                            body: formData
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            showMessage("‚úÖ Post joylandi!");
                            setTimeout(() => window.location.href = '/', 1500);
                        } else {
                            showMessage('Post yaratishda xatolik: ' + data.message, 'error');
                        }
                    } else if (selectedMediaUrl) {
                        // URL
                        const response = await fetch('/posts', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ content, media: selectedMediaUrl, boostLevel })
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            showMessage("‚úÖ Post joylandi!");
                            setTimeout(() => window.location.href = '/', 1500);
                        } else {
                            showMessage('Post yaratishda xatolik: ' + data.message, 'error');
                        }
                    } else {
                        // Text only
                        const response = await fetch('/posts', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ content, boostLevel })
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            showMessage("‚úÖ Post joylandi!");
                            setTimeout(() => window.location.href = '/', 1500);
                        } else {
                            showMessage('Post yaratishda xatolik: ' + data.message, 'error');
                        }
                    }
                } catch (error) {
                    console.error('Xatolik:', error);
                    showMessage('Post yaratishda xatolik', 'error');
                }
            });
        }

        function loadStickers() {
            const section = document.getElementById('stickerSection');
            let stickersHtml = basicStickers.map(sticker => `<div class="sticker-item" data-sticker="${sticker}">${sticker}</div>`).join('');
            
            if (currentUser && currentUser.isPremium && (!currentUser.premiumExpiresAt || new Date(currentUser.premiumExpiresAt) > new Date())) {
                stickersHtml += premiumAnimatedStickers.map(sticker => 
                    `<img src="${sticker.url}" alt="${sticker.name}" class="sticker-item premium-sticker" data-url="${sticker.url}" style="width: 40px; height: 40px; border-radius: 0.5rem; object-fit: cover;">`
                ).join('');
            }
            
            section.innerHTML = stickersHtml;
            
            // Basic stiker click events
            section.querySelectorAll('.sticker-item:not(img)').forEach(item => {
                item.addEventListener('click', () => {
                    const sticker = item.dataset.sticker;
                    const range = quill.getSelection();
                    const index = range ? range.index : quill.getLength();
                    quill.insertText(index, sticker);
                });
            });
            
            // Premium animated stiker click events
            section.querySelectorAll('.sticker-item img').forEach(item => {
                item.addEventListener('click', () => {
                    const url = item.dataset.url;
                    const range = quill.getSelection();
                    const index = range ? range.index : quill.getLength();
                    const imgHtml = `<img src="${url}" alt="Animated Sticker" class="animated-sticker">`;
                    quill.clipboard.dangerouslyPasteHTML(index, imgHtml);
                });
            });
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                selectedFile = file;
                selectedMediaUrl = ''; // Clear URL if file selected
                previewMedia(file);
            }
        }

        function handleMediaUrlChange(e) {
            const url = e.target.value.trim();
            if (url) {
                selectedFile = null; // Clear file if URL entered
                selectedMediaUrl = url;
                previewMedia(url);
            } else {
                document.getElementById('mediaPreview').innerHTML = '';
            }
        }

        function previewMedia(src) {
            const preview = document.getElementById('mediaPreview');
            if (src instanceof File) {
                const url = URL.createObjectURL(src);
                const isVideo = src.type.startsWith('video/');
                preview.innerHTML = `
                    <div class="media-preview relative">
                        ${isVideo ? `<video src="${url}" controls class="w-full rounded-xl"></video>` : `<img src="${url}" alt="Preview" class="w-full rounded-xl">`}
                        <button type="button" class="remove-media" onclick="removeMediaPreview()">‚úï</button>
                    </div>
                `;
            } else {
                const isVideo = src.match(/\.(mp4|webm|ogg)$/i);
                preview.innerHTML = `
                    <div class="media-preview relative">
                        ${isVideo ? `<video src="${src}" controls class="w-full rounded-xl"></video>` : `<img src="${src}" alt="Preview" class="w-full rounded-xl" onerror="this.style.display='none'">`}
                        <button type="button" class="remove-media" onclick="removeMediaPreview()">‚úï</button>
                    </div>
                `;
            }
        }

        function removeMediaPreview() {
            document.getElementById('postFile').value = '';
            document.getElementById('postMedia').value = '';
            document.getElementById('mediaPreview').innerHTML = '';
            selectedFile = null;
            selectedMediaUrl = '';
        }

        function showMessage(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `fixed bottom-4 right-4 px-4 py-2 rounded-xl text-white font-medium z-50 ${
                type === 'success' ? 'bg-green-500' : 'bg-red-500'
            }`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
    </script>
</body>
</html>